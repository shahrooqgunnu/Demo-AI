name: ğŸš€ Deploy FinMinds Streamlit App

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write    # ğŸ‘ˆ allows pushing to gh-pages branch

jobs:
  deploy:
    name: Auto Deploy to Streamlit Cloud
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: ğŸ“¦ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: âœ… Verify Streamlit App Syntax
        run: |
          python -m py_compile app.py || echo "âœ… Syntax OK"

      - name: ğŸ” Trigger Streamlit Auto-Redeploy
        if: github.ref == 'refs/heads/main'
        run: |
          echo "ğŸ”„ Redeploy triggered automatically by Streamlit Cloud"
          echo "If your repo is already linked to Streamlit Cloud, it will redeploy automatically."
          echo "Live URL: https://finminds.streamlit.app"

      - name: ğŸŒ Publish GitHub Pages Redirect
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: gh-pages

      - name: âœ… Deployment Complete
        run: |
          echo "ğŸ‰ FinMinds Streamlit app successfully redeployed!"
          echo "ğŸ”— GitHub Pages: https://finminds.github.io/ai-portal"
          echo "ğŸ”— Streamlit App: https://finminds.streamlit.app"
